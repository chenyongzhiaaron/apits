# 案例

**本小节目标**：
* 掌握序列化器改写图书管理RestAPI接口的案例
* 理解RestAPI接口开发时，序列化器的使用


## 序列化器改写图书管理RestAPI

使用序列化器改写之前图书管理的RestAPI接口。

> 注：在图书管理RestAPI接口中，凡是进行序列化和反序列化的地方，可以使用序列化器进行改写。

```python
# views.py
from booktest.serializers import BookInfoSerializer

# /books/
class BookListView(View):
    """
    获取所有图书、增加图书
    """
    def get(self, request):
        """
        获取所有的图书数据
        """
        queryset = BookInfo.objects.all()

        # 序列化所有图书数据
        serializer = BookInfoSerializer(queryset, many=True)

        return JsonResponse(serializer.data, safe=False)

    def post(self, request):
        """
        新增一个图书数据
        """
        json_bytes = request.body
        json_str = json_bytes.decode()
        book_dict = json.loads(json_str)

        # 反序列化-数据校验
        serializer = BookInfoSerializer(data=book_dict)
        serializer.is_valid(raise_exception=True)

        # 反序列化-数据保存(save内部会调用序列化器类的create方法)
        serializer.save()

        return JsonResponse(serializer.data, status=201)

# /books/(?P<pk>\d+)/
class BookDetailView(View):
    """
    获取、修改、删除指定图书
    """
    def get(self, request, pk):
        """
        获取指定图书
        """
        try:
            book = BookInfo.objects.get(pk=pk)
        except BookInfo.DoesNotExist:
            return HttpResponse(status=404)

        # 将图书数据进行序列化
        serializer = BookInfoSerializer(book)

        return JsonResponse(serializer.data)

    def put(self, request, pk):
        """
        修改指定图书
        """
        try:
            book = BookInfo.objects.get(pk=pk)
        except BookInfo.DoesNotExist:
            return HttpResponse(status=404)

        json_bytes = request.body
        json_str = json_bytes.decode()
        book_dict = json.loads(json_str)

        # 反序列化-数据校验
        serializer = BookInfoSerializer(book, data=book_dict)
        serializer.is_valid(raise_exception=True)

        # 反序列化-数据保存(save内部会调用序列化器类的update方法)
        serializer.save()

        return JsonResponse(serializer.data)

    def delete(self, request, pk):
        """
        删除指定图书：
        """
        try:
            book = BookInfo.objects.get(pk=pk)
        except BookInfo.DoesNotExist:
            return HttpResponse(status=404)

        book.delete()

        return HttpResponse(status=204)
```

**总结**：
  * 在进行RestAPI接口开发时，序列化操作和反序列化操作的地方都可以使用序列化器来做。
