# DRF框架功能演示

**本小节学习目标**：
* 了解DRF框架的一些名词：视图集、序列化器、路由Router

## 功能演示

> 注：此案例仅做DRF框架功能演示使用，现阶段不需要深究代码。

使用Django REST framework快速实现图书管理的5个RestAPI。

### 1. 创建序列化器类

在`booktest`应用中新建`serializers.py`用于保存该应用的序列化器类。

```python
class BookInfoSerializer(serializers.ModelSerializer):
    """图书序列化器类"""
    class Meta:
        model = BookInfo
        fields = '__all__'
```

* **model**：指定该序列化器类所对应的模型类
* **fields**：指定依据模型类的哪些字段生成对应序列化器类的字段，`__all__`代表所有

### 2. 编写视图

在`booktest`应用的`views.py`中创建视图`BookInfoViewSet`，这是一个视图集合。

```python
from rest_framework.viewsets import ModelViewSet
from booktest.serializers import BookInfoSerializer
from booktest.models import BookInfo

class BookInfoViewSet(ModelViewSet):
    """视图集"""
    queryset = BookInfo.objects.all()
    serializer_class = BookInfoSerializer
```

* **queryset**：指定视图集在进行数据查询时所使用的查询集
* **serializer_class**：指定视图集在进行序列化或反序列化时所使用的序列化器类

### 3. 定义路由

在`booktest`应用的`urls.py`中进行URL配置。

```python
from booktest import views
from rest_framework.routers import DefaultRouter

urlpatterns = [
    ...
]

# 路由Router: 动态生成视图集中处理函数的url配置项
router = DefaultRouter()  # 路由Router
router.register('books', views.BookInfoViewSet, name='books')  # 向路由Router中注册视图集

urlpatterns += router.urls  # 将路由Router生成的url配置信息添加到django的路由列表中
```

### 4. 运行测试

运行当前程序（与运行Django一样）

```shell
python manage.py runserver
```

在浏览器中输入网址127.0.0.1:8000，可以看到DRF提供的API Web浏览页面：

![图书接口Web浏览页面](./assets/图书接口Web浏览页面.png)

1）点击链接127.0.0.1:8000/books/ 可以访问**获取所有数据的接口**，呈现如下页面：

![查询所有图书信息1](./assets/查询所有图书信息1.png)

![查询所有图书信息2](./assets/查询所有图书页面2.png)

2）在页面底下表单部分填写图书信息，可以访问**添加新图书的接口**，保存新书：

![保存新图书](./assets/保存新图书信息.png)

点击POST后，返回如下页面信息：

![保存图书返回信息](./assets/保存图书返回信息.png)

3）在浏览器中输入网址127.0.0.1:8000/books/1/，可以访问**获取单一图书信息的接口**（id为1的图书），呈现如下页面：

![获取单一图书信息](./assets/获取单一图书信息.png)

4）在页面底部表单中填写图书信息，可以访问**修改图书的接口**：

![修改图书信息](./assets/修改图书信息.png)

点击PUT，返回如下页面信息：

![修改图书返回信息](./assets/修改图书返回信息.png)

5）点击DELETE按钮，可以访问**删除图书的接口**：

![删除图书](./assets/删除图书.png)

返回，如下页面：

![删除图书返回信息](./assets/删除返回信息.png)

至此，是不是发现Django REST framework很好用！

**总结**：
* 视图集、序列化器类、路由Router

