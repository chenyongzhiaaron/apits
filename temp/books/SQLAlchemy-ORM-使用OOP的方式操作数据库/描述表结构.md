#  描述表结构

## 1. 什么是描述表结构

所谓：描述表结构，就是用一种方式来说明、描述出表名字以及字段等要求

## 2.怎样描述

要使用 ORM, 我们需要将数据表的结构用 ORM 的语言描述出来

`SQLAlchmey` 提供了一套 `Declarative（声明）系统`来完成这个任务

通俗的说：

> 就是用SQLAlchemy自带的功能，用类来描述，而不再使用之前的SQL语句

## 3. 定义模型案例

我们以创建一个 `users` 表为例，看看它是怎么用 SQLAlchemy 的语言来描述的：

```python
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy import Column, String, Integer

# 生成SQLORM基类
Base = declarative_base()  


# 定义一个类，继承自Base，这个类就对应数据表
class User(Base):
    # 对应MySQL中数据表的名字
    __tablename__ = 'users'

    # 创建字段
    id = Column(Integer, primary_key=True)  # users表中的id字段(主键)
    username = Column(String(64), nullable=False, index=True)  # users表中的username字段(有索引)
    password = Column(String(64), nullable=False)  # users表中的password字段
    email = Column(String(64), nullable=False, index=True)  # users表中的email字段(有索引)

    def __repr__(self):
        return '%s(%r)' % (self.__class__.__name__, self.username)

```

说明：

- `__tablename__` 指定在 MySQL 中表的名字
- 创建了三个基本字段，类中的每一个 `Column` 代表数据库中的一列，在 `Colunm`中，指定该列的一些配置
  - 第一个字段代表类的数据类型，上面我们使用 `String`, `Integer` 俩个最常用的类型，其他常用的包括：
    - Text
    - Boolean
    - SmallInteger
    - DateTime
  - `nullable=False` 代表这一列不可以为空
  - `index=True` 表示在该列创建索引
- 定义 `__repr__` 是为了方便调试，你可以不定义，也可以定义的更详细一些



## 4. 执行ORM模型

`db.py`代码进行了更新：

```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy import Column, String, Integer


# 链接是需要指定要用到的MySQL数据库
engine = create_engine('mysql+pymysql://root:python@localhost:3306/py3_sqlalchemy_2019?charset=utf8', echo=True)
Base = declarative_base()  # 生成SQLORM基类


class User(Base):
    # 对应MySQL中数据表的名字
    __tablename__ = 'users'

    # 创建字段
    id = Column(Integer, primary_key=True)  # users表中的id字段(主键)
    username = Column(String(64), nullable=False, index=True)  # users表中的username字段
    password = Column(String(64), nullable=False)  # users表中的password字段
    email = Column(String(64), nullable=False, index=True)  # users表中的email字段(有索引)

    def __repr__(self):
        return '%s(%r)' % (self.__class__.__name__, self.username)


# 执行下面的代码，会创建userinfo表（所有表结构）
Base.metadata.create_all(engine)

```

运行程序：

```
python3 db.py
```

运行效果：

我们在 MySQL 中看看表是如何创建的：

![image-20180810165613730](assets/05-sqlalchemy/image-20180810165613730.png)

![image-20180810170246325](assets/05-sqlalchemy/image-20180810170246325.png)