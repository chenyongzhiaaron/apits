# MongoDB的进阶用法



## 准备数据，以便下面的练习

### 1. 创建数据test2

```
use test2
```

### 2. 插入文档（数据表的名字是stu）

```
db.stu.insertMany([{"name" : "郭靖", "hometown" : "蒙古", "age" : 20, "gender" : true },{"name" : "⻩蓉", "hometown" : "桃花岛", "age" : 18, "gender" : false },{"name" : "华筝", "hometown" : "蒙古", "age" : 18, "gender" : false },{"name" : "⻩药师", "hometown" : "桃花岛", "age" : 40, "gender" : true },{"name" : "段誉", "hometown" : "⼤理", "age" : 16, "gender" : true },{"name" : "段王爷", "hometown" : "⼤理", "age" : 45, "gender" : true },{"name" : "洪七公", "hometown" : "华⼭", "age" : 18, "gender" : true }])
```





## 一、limit

`limit()`： ⽤于读取指定数量的⽂档

用法：

```
db.集合名称.find().limit(NUMBER)
```

查询2条学⽣信息：

```
db.stu.find().limit(2)
```



## 二、skip

`skip()`： ⽤于跳过指定数量的⽂档

用法：

```
db.集合名称.find().skip(NUMBER)
```

跳过前2个，从第3个开始查询：

```
db.stu.find().skip(2)
```



## 三、同时使用limit和skip

```
db.stu.find().limit(4).skip(5)
或
db.stu.find().skip(5).limit(4)
```

注意：

> 先使用skip在使用limit的效率要高于前者



## 四、投影

在查询到的返回结果中， 只选择必要的字段

命令：

```
db.集合名称.find({},{field:1,...})
```

说明：

* 参数为字段和值， 值为`1`表示显示， 值为`0`不显 

* 特别注意： 对于`_id`列默认是显示的， 如果不显示需要明确设置为`0`

demo：

```
db.stu.find({},{_id:0,name:1,gender:1})
```



## 五、排序

 ⽅法`sort()`， ⽤于对结果集进⾏排序

 命令：

```
db.集合名称.find().sort({字段:1,...})
```

说明：

* 参数`1`为升序排列  参数`-1`为降序排列



demo:根据性别降序， 再根据年龄升序

```
db.stu.find().sort({gender:-1,age:1})
```



## 六、统计个数

⽅法`count()`⽤于统计结果集中⽂档条数

命令方式1：

```
db.集合名称.find({条件}).count()
```

命令方式2：

```
db.集合名称.count({条件})
```

demo：

```
 db.stu.find({gender:true}).count()
 db.stu.count({age:{$gt:20},gender:true})
```



## 七、消除重复

⽅法`distinct()`对数据进⾏去重

命令：

```
db.集合名称.distinct('去重字段',{条件})
```

demo：年龄大于18岁的所有不重复的hometown

```
db.stu.distinct('hometown',{age:{$gt:18}})
```
