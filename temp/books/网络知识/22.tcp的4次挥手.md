# TCP的4次挥手

## 1. 引入

> 既然3次握手双方建立资源，当通信结束后，就应该将这些数据释放，此时就有了4次挥手的原因

## 2. 讲解



![image-20181210125328511](https://cdn.itprojects.cn/iotimg/3973v.png)

## 3. 小结

1. 为了释放资源，所以双方需要协商怎样关闭这个虚拟的通道，这就是4次挥手的目的
2. 4次挥手的过程
   1. 客户端先发送一个数据包，这里有1个数字，例如100，4次挥手开始的第1次数据包称为FIN
   2. 服务器接收到FIN数据包，然后将100提取出来，然后+1，最后将101，通过ACK数据包会送给客户端
      1. 此时服务器端的recv会解堵塞，并且返回的数据长度为0
      2. 如果服务器对这个已经建立的套接字调用了close，那么就会有下面的2次挥手
   3. 服务器发送一个数据，这有1个数字，例如102，这个包类型是FIN
   4. 当客户单接收到服务器的FIN时，提取出102，然后+1，然后用ACK将103回送给服务器