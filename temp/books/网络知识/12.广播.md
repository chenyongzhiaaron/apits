# 广播

## 1. 引入

思考一个问题：

> 假如在我们现在的教室局域网(192.168.14.x)中，如果想给其他所有电脑上的2425端口发送一个相同的数据，改怎样做呢？

你可能会这样做：

> 写一个程序，使用循环的方式向192.168.14.1一直到192.168.14.254这个范围的所有电脑上的2425端口 发送一次数据即可。
>
> 这样做能实现，但是效率非常低，因为需要将这个数据发送254次，如果换到了B类的局域网中那么就需要发送65534次，显然这么做是不太恰当的

那该怎样做？

> 要是能发送一次数据，这个数据会被所有的电脑都接收，那就给力了，，，，恰巧接下来要讲解的UDP广播就能实现这个功能

## 2. 广播的作用

socket只需要发送1次UDP数据，就可以发送给本局域网中的任何一台电脑发送相同的数据

![image-20181205224348920](https://cdn.itprojects.cn/iotimg/1thlj.png)

## 3. 使用UDP广播的流程

```python
import socket

# 1. 创建UDP套接字
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# 2. 设置UDP套接字允许其广播(注意如果udp套接字需要广播，则一定要添加此语句)
s.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)

# 选做 绑定本地信息
# s.bind(("", 8080))

# 4. 向本局域网中发送广播数据
# 此时只要是本局域网中的电脑上有 用1060端口的udp程序 它就会收到此数据
dest_info = ("<broadcast>", 1060)  # <broadcast>会自动改为本局域网的广播ip
s.sendto('hello world !'.encode('utf-8'), dest_info)

# 5. 关闭套接字
s.close()
```

## 4. 小总结

> 如果需要用到广播，则需要对这个套接字进行设置，方式是很固定的，如下
>
> 套接字.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)
>
> 但是要注意一点：真正用到广播那么就考虑添加这个设置，否则不要添加，因为这样会到这个局域网中会比较拥堵