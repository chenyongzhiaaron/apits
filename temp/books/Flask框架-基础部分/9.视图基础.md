# 视图基础

## 1. 视图函数

上一章节中学习了 路由：浏览器访问时flask是按照规则去调用哪个函数；

那么大家应该还记得那个处理的“函数”，那个函数中可以通过`return`将一个字符串返回，那么浏览器就可以看到访问指定的url时需要的页面数据

我们把那个"函数"称之为 视图（`视图函数`）

通俗的说：这个视图函数就是用来处理某个url的逻辑的

## 2. 返回的数据

- 返回 JSON
- 重定向函数url_for
- 自定义状态码

### 2.1 返回JSON

在使用 Flask 写一个接口时候需要给客户端返回 `JSON` 数据，在 Flask 中可以直接使用 `jsonify` 生成一个 JSON 的响应

```python
# 返回JSON
@app.route('/demo4')
def demo4():
    json_dict = {
        "user_id": 10,
        "user_name": "laowang"
    }
    return jsonify(json_dict)
```

> 不推荐使用 json.dumps 转成 JSON 字符串直接返回，因为返回的数据要符合 HTTP 协议规范，如果是 JSON 需要指定 `content-type:application/json`

### 2.2 重定向

- 重定向到 **baidu** 官网

```python
# 重定向
@app.route('/demo5')
def demo5():
    return redirect('http://www.baidu.com')
```

- 重定向到自己写的视图函数
    - 可以直接填写自己 url 路径
    - 也可以使用 url_for 生成指定视图函数所对应的 url

```python

@app.route('/demo1_url')
def demo1():
    return 'demo1'

# 重定向
@app.route('/demo5')
def demo5():
    return redirect(url_for('demo1'))  # 注意url_for中写如的是视图函数的名字且是字符串展示
```

- 重定向到带有参数的视图函数
    - 在 url_for 函数中传入参数

```python
# 路由传递参数
@app.route('/user/<int:user_id>')
def user_info(user_id):
    return 'hello %d' % user_id

# 重定向
@app.route('/demo5')
def demo5():
    # 使用 url_for 生成指定视图函数所对应的 url
    return redirect(url_for('user_info', user_id=100))
```

### 2.3 自定义状态码

- 在 Flask 中，可以很方便的返回自定义状态码，以实现不符合 http 协议的状态码，例如：status code: 666

```python
@app.route('/demo6')
def demo6():
    return '状态码为 666', 666
```

