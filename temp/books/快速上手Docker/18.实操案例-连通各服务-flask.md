# 连通各服务



## 1. 合并为一个`docker-compose.yml`文件

将之前的3个`docker-compose.yml`文件合并为一个，内容如下：

```yaml
version: '3'
services:
    redis:
        image: redis
        expose:
            - 6379
        ports:
            - "6399:6379"
    mysql:
        image: mysql:5.5
        expose:
            - 3306
        ports:
            - "3307:3306"
        environment:
            MYSQL_ROOT_PASSWORD: python
            MYSQL_USER: root
        volumes:
            - ./02_mysql:/var/lib/mysql
    flask:
        build: ./01_flask
        volumes:
            - ./01_flask/project:/home/project
        ports:
            - "5000:5000"
        depends_on:
            - mysql
            - redis
```

注意：

`depends_on`表示依赖，如上述代码中意思是：需要运行flask服务那么需要先运行redis、mysq服务，但并不能保证在flask服务运行前它们已经成功的运行起来，只能保证它们先运行



## 2. 运行效果

运行命令:

```
docker-compose up
```

<img src="assets/image-20201215205514504.png" alt="image-20201215205514504" style="zoom:50%;" />

<img src="assets/image-20201215205601068.png" alt="image-20201215205601068" style="zoom:50%;" />

使用`docker-compose ps`查看

<img src="assets/image-20201215205714640.png" alt="image-20201215205714640" style="zoom:50%;" />

如果需要关闭服务，则使用`ctrl+c`的方式

<img src="assets/image-20201215205752128.png" alt="image-20201215205752128" style="zoom:50%;" />