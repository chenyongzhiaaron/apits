# 构建flask服务



进入到`01_flask`文件夹



## 1. 建立`Dockerfile`文件

新建`Dockerfile`文件，如下：

```dockerfile
FROM ubuntu:16.04

# 复制国内更新源
COPY sources.list /etc/apt/sources.list

# 跳转到指定目录
WORKDIR /home

# 复制文件到容器
COPY requirements.txt .

# 安装vim、python3、pip3以及flask用的包
RUN apt-get update && apt-get install vim -y \
    && apt-get install python3 -y \
    && apt-get install python3-pip -y \
    && pip3 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 跳转到指定目录
WORKDIR /home/project

# 运行测试项目
CMD ["python3","app.py"]
```



### 2. 建立`requirements.txt`

新建`requirements.txt`文件，内容如下：

```
alembic==1.4.3
aliyun-python-sdk-core==2.13.30
cachelib==0.1.1
certifi==2020.12.5
cffi==1.14.4
chardet==3.0.4
click==7.1.2
cryptography==3.2.1
Flask==1.1.2
Flask-Migrate==2.5.3
Flask-Script==2.0.6
Flask-Session==0.3.2
Flask-SQLAlchemy==2.4.4
idna==2.10
itsdangerous==1.1.0
Jinja2==2.11.2
jmespath==0.10.0
Mako==1.1.3
MarkupSafe==1.1.1
pycparser==2.20
pycrypto==2.6.1
PyMySQL==0.10.1
python-dateutil==2.8.1
python-editor==1.0.4
qiniu==7.3.0
redis==3.5.3
requests==2.25.0
six==1.15.0
SQLAlchemy==1.3.20
urllib3==1.26.2
Werkzeug==1.0.1
```



## 3. 建立`sources.list`

新建`sources.list`文件，内容如下：

```
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial multiverse
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates multiverse
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security multiverse
```



## 4. 建立项目文件夹

新建立一个文件夹`project`，目的是以后将flask项目代码共享到此目录

```shell
mkdir project
```

此时`01_flask`文件中的效果如下：

![image-20201215202042725](assets/image-20201215202042725.png)



## 5. 在project文件夹下建立flask项目

进入到`project`文件夹，然后新建`app.py`，内容如下：

```python
from flask import Flask


app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello World!'

if __name__ == "__main__":
    app.run(host="0.0.0.0", debug=True)  # 注意默认端口为5000

```



## 6. 建立`docker-compose.yml`

跳转到`docker_compose`路径下，然后新建`docker-compose.yml`文件，内容如下：

```yaml
version: '3'
services:
  flask:
    build: ./01_flask
    volumes:
     - ./01_flask/project:/home/project
    ports:
     - "5000:5000"
```

效果如下：

<img src="assets/image-20201215202515458.png" alt="image-20201215202515458" style="zoom:50%;" />



## 7. 构建flask服务

执行如下命令

```
docker-compose build
```

<img src="assets/image-20201215202639120.png" alt="image-20201215202639120" style="zoom:50%;" />

构建成功

<img src="assets/image-20201215203958840.png" alt="image-20201215203958840" style="zoom:50%;" />

说明：

因为此时的`docker-compose.yml`文件中只有一个`flask`的服务，所以只创建了这个镜像

使用`docker-compose up`运行服务，此时效果如下：

<img src="assets/image-20201215204241488.png" alt="image-20201215204241488" style="zoom:50%;" />