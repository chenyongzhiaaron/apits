# RESTful风格

**本小节学习目标**：
* 理解RestAPI接口设计风格的关键点
* 了解RestAPI接口设计风格的其他内容

## RestAPI接口设计风格

在进行API接口设计时，不同的开发人员可能有不同的设计风格，风格迥异。

那是否存在一种统一的接口设计方式，被广大开发人员所接受呢？

答: **这就是被普遍采用的RESTful API设计风格**。

### 1. Restful风格设计-关键点

####  1. URL路径

**URL地址尽量使用名词复数，不要使用动词**。

例如：
```http
# 不好的例子
/getProducts
/listOrders

# 正确的例子
GET /products：将返回所有产品信息
POST /products：将新建产品信息
GET /products/4：将获取产品4
PUT /products/4：将更新产品4
```
> 路径又称"终点"（endpoint），表示API的具体网址，每个网址代表一种资源（resource）。

#### 2. 请求方式

**访问同一个URL地址，采用不同的请求方式，代表要执行不同的操作**。

常用的HTTP请求方式有下面四个：

| 请求方式 | 说明        |
| ------ | ----------- |
| GET    | 获取资源数据(单个或多个) |
| POST   | 新增资源数据 |
| PUT    | 修改资源数据 |
| DELETE | 删除资源数据 |

例如：

```http
GET /books：列出所有图书数据
POST /books：新建一本图书数据
GET /books/<id>/：获取某个指定的图书数据
PUT /books/<id>/：更新某个指定的图书数据
DELETE /books/<id>/：删除某个指定的图书数据
```

#### 3. 过滤信息

**过滤参数可以放在查询字符串中**。

在访问API接口获取数据时，可能需要对数据进行过滤。

常见的参数：
```http
?limit=10：指定返回记录的数量
?offset=10：指定返回记录的开始位置。
?page=2&pagesize=100：指定第几页，以及每页的记录数。
?sortby=name&order=asc：指定返回结果按照哪个属性排序，以及排序顺序。
```

#### 4. 响应数据

**针对不同操作，服务器向用户返回不同的响应数据**。

一般遵循以下规范：
```http
1. 获取一组数据，返回一组数据
2. 获取指定数据，返回指定数据
3. 新增数据，返回新增的数据
4. 修改数据，返回修改的数据
5. 删除数据，返回空
```

#### 5. 响应数据格式

**服务器返回的响应数据格式，应该尽量使用JSON**。

#### 6. 响应状态码

服务器向客户端返回的状态码和提示信息，常见的状态码如下：
```http
200 OK - [GET/PUT]：服务器成功返回用户请求的数据
201 CREATED - [POST]：用户新建数据成功。
204 NO CONTENT - [DELETE]：用户删除数据成功。
400 INVALID REQUEST - [POST/PUT]：用户发出的请求有错误，服务器没有进行新建或修改数据的操作
404 NOT FOUND - [*]：用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的。。
500 INTERNAL SERVER ERROR - [*]：服务器发生错误，用户将无法判断发出的请求是否成功。
```
状态码的完全列表参见[这里](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)或[这里](https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81)。


### 2. Restful风格设计-其他

#### 1. 域名

应该尽量将API部署在专用域名之下。

```http
https://api.example.com
```

如果确定API很简单，不会有进一步扩展，可以考虑放在主域名下。

```http
https://www.example.com/api/
```

#### 2. 版本

应该将API的版本号放入URL。

```http
http://www.example.com/api/1.0/foo

http://www.example.com/api/1.1/foo

http://www.example.com/api/2.0/foo
```

另一种做法是，将版本号放在HTTP头信息中，但不如放入URL方便和直观。[Github](https://developer.github.com/v3/media/#request-specific-version)采用这种做法。

#### 3. 错误处理

如果状态码是4xx，服务器就应该向用户返回出错信息。

```json
{
    error: "<error message>"
}
```

#### 4. 超媒体

RESTful API最好做到Hypermedia（即返回结果中提供链接，指向其他API方法），使得用户不查文档，也知道下一步应该做什么。

比如，Github的API就是这种设计，访问[api.github.com](https://api.github.com/)会得到一个所有可用API的网址列表。

```json
{
    "current_user_url": "https://api.github.com/user",
    "authorizations_url": "https://api.github.com/authorizations",
    // ...
}
```

从上面可以看到，如果想获取当前用户的信息，应该去访问[api.github.com/user](https://api.github.com/user)，然后就得到了下面结果。

```json
{
    "message": "Requires authentication",
    "documentation_url": "https://developer.github.com/v3"
}
```

上面代码表示，服务器给出了提示信息，以及文档的网址。

**总结**：

| 要点         |                                                              |
| ------------ | ------------------------------------------------------------ |
| url地址      | url地址尽量使用名词复数，不要使用动词                        |
| 请求方式     | 执行不同的操作，采用不同的请求方式：<br/>GET(获取)<br/>POST(新增)<br/>PUT(修改)<br/>DELETE(删除) |
| 过滤参数     | 过滤参数放在查询字符串中                                     |
| 响应数据     | 获取多个数据时，返回对应的多个数据<br/> 获取单个数据时，返回对应的单个数据<br/> 新增数据时，将新增的数据返回<br/> 修改数据时，将修改的数据返回<br/> 删除数据时，返回空 |
| 响应数据格式 | JSON                                                         |
| 响应状态码   | 200(获取或修改成功)<br/>201(新增成功) <br/>204(删除成功) <br/>404(资源找不到)<br/>500(服务器出错) |
