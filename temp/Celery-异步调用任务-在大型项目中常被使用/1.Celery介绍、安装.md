# Celery学习与使用

## 1. 引入

思考：

- 消费者取到消息之后，要消费掉（执行任务），需要我们去实现
- 任务可能出现高并发的情况，需要补充多任务的方式执行
- 耗时任务很多种，每种耗时任务编写的生产者和消费者代码有重复
- 取到的消息什么时候执行，以什么样的方式执行

结论：

- 实际开发中，我们可以借助成熟的工具`Celery`来完成
- 有了`Celery`，我们在使用生产者消费者模式时，只需要关注任务本身，极大的简化了开发者的开发流程

## 2.介绍

- 一个简单、灵活且可靠、处理大量消息的分布式系统，可以在一台或者多台机器上运行
- Celery是一个功能完备**即插即用**的任务队列
- 单个 Celery 进程**每分钟可处理数以百万计**的任务
- 通过消息进行通信，使用`消息队列（broker）`在`客户端`和`消费者`之间进行协调

## 3. Celery特性

Celery 需要一个发送和接受消息的传输者

Celery可以使用`RabbitMQ` 和 `Redis` 作为中间人进行消息传输。但也提供大量其他实验性方案的支持，包括用 `SQLite` 进行本地开发。

Celery可以单机运行，也可以在多台机器上运行，甚至可以跨越数据中心运行

- 简单

  易于使用和维护

- 高可用性

  倘若连接丢失或失败，职程和客户端会自动重试，并且一些中间人通过 `主/主` 或 `主/从` 方式复制来提高可用性

- 快速

  单个 Celery 进程每分钟可处理数以百万计的任务，而保持往返延迟在亚毫秒级

- 灵活

  Celery 几乎所有部分都可以扩展或单独使用。可以自制连接池、 序列化、压缩模式、日志、调度器、消费者、生产者、自动扩展、 中间人传输或更多

## 4. 名词说明

![image-20191129134950400](assets/image-20191129134950400.png)

客户端：发送任务的一方

broker：消息中间件，例如RabbitMQ

worker：执行任务的一方

## 5. 安装

使用`pip`命令安装

```
pip3 install Celery
```

如果网速慢可以尝试添加更新下载url

```
pip install Celery -i http://pypi.douban.com/simple/ --trusted-host pypi.douban.com
```

下载&安装成功

![image-20191129094654845](assets/image-20191129094654845.png)

![image-20191129094720026](assets/image-20191129094720026.png)