# MongoDB的权限管理



## 一、为什么要进行权限管理的设置

刚安装完毕的MongoDB默认不使用权限认证方式启动，与MySQL不同，MongoDB在安装的时候并没有设置权限，然而公网运行系统需要设置权限以保证数据安全，所以我们要学习mongodb的权限管理



## 二、MongoDB的权限管理方案

MongoDB是没有默认管理员账号，所以要先添加管理员账号，并且MongoDB服务器需要在运行的时候开启验证模式
- 用户只能在用户所在数据库登录(创建用户的数据库)，包括管理员账号
- 管理员可以管理所有数据库，但是不能直接管理其他数据库，要先认证后才可以



## 三、MongoDB超级管理员账号的创建

### 1. 以权限认证的方式启动MongoDB数据库

```js
sudo mongod -auth
```

启动之后在启动信息中会有如下信息，说明MongoDB以权限认证的方式启动成功

```
[initandlisten] options: { security: { authorization: "enabled" } }
```

### 2. 创建超级用户

使用admin数据库(超级管理员账号必须创建在该数据库上)

切换数据库

```js
use admin
```

创建超级用户

```js
db.createUser({"user":"python","pwd":"python","roles":["root"]})
```

创建成功会显示如下信息

```js
Successfully added user: { "user" : "python", "roles" : [ "root" ] }
```

### 3. 退出客户端再次登录验证

此时再使用数据库各命令的时候会报权限错误，需要认证才能执行相应操作

```js
use admin
db.auth('python','python')
1
```

python用户是创建在admin数据库上的所以必须来到admin数据库上进行认证,认证成功会返回1，失败返回0



## 四、创建普通用户

### 1. 选择需要创建用户的数据库

```js
use test1
```

### 2. 在使用的数据库上创建普通用户

```js
# 创建普通用户user1,该用户在test1上的权限是只读
db.createUser({"user":"user1", "pwd":"pwd1", roles:["read"]})

# 创建普通用户user2,该用户在test1上的权限是读写
db.createUser({"user":"user2", "pwd":"pwd1", roles:["readWrite"]})
```

注意：

* 创建新用户后用户的信息存储在admin数据库中

  ![image-20201109183234194](assets/image-20201109183234194.png)





## 五、查看创建的用户

```js
show users
{
    "_id" : "admin.python",
    "user" : "python",
    "db" : "admin",
    "roles" : [
        {
            "role" : "root",
            "db" : "admin"
        }
    ]
}
```



## 六、删除用户

```js
db.dropUser('python')
```



## 七、pymongo认证用户

![image-20201109185516087](assets/image-20201109185516087.png)