# 路由基础

## 1. 查看url对应的函数（路由）

在程序运行过程中，程序实例中会使用 `url_map` 将装饰器路由和视图的对应关系保存起来，打印结果如下图：

![image-20180812110726137](assets/image-20180812110726137.png)

- 明确路由定义的参数，请求方式指定
- PostMan 的使用

## 2. 指定路由地址

#### 如果需要让浏览器可以访问一个新的url，那么需要添加一个路由

* 路由的地址确定，那么就确定了浏览器访问时的url
* 函数的名字可以任意，只要不重复就行

```python
@app.route("/test")  # 这里的路由决定了浏览器访问时的url，而不是下面的函数名字
def test():  # 定义时函数的名字不一定是test，可以是其他的名字
    return "这是test页面"
```

#### 完整的代码如下:

```python
from flask import Flask

# 创建flask对象
app = Flask(__name__)

@app.route("/")
def index():
    """
    这个函数用来完成一个url对应的逻辑处理
    :return:
    """
    return "哈哈哈 ，我是第一个flask页面，成功的道理开始了..."

@app.route("/profile")
def profile():
    """
    返回html页面数据
    :return:
    """
    # return "<h1>我是个人主页</h1>"
    with open("profile.html") as f:
        content = f.read()
    return content

@app.route("/test")
def test():
    return "这是test页面"

if __name__ == '__main__':
    app.run()

```



## 3. 给路由传参示例

有时我们需要将同一类 URL 映射到同一个视图函数处理，比如：使用同一个视图函数来显示不同用户的个人信息。

#### 示例代码：

```python
@app.route("/profile_v2/<user_id>")  # <user_id>表示匹配url时，这里的数据提取出来
def profile_v2(user_id):  # 将提取出来的数据传递给<user_id>中<>内的名字，而且函数的形参也是这个名字
    return "<h1>这是%s的个人主页</h1>" % user_id
```

#### 完整的代码如下：

```python
from flask import Flask

# 创建flask对象
app = Flask(__name__)

@app.route("/")
def index():
    """
    这个函数用来完成一个url对应的逻辑处理
    :return:
    """
    return "哈哈哈 ，我是第一个flask页面，成功的道理开始了..."

@app.route("/test")
def test():
    return "这是test页面"

@app.route("/profile")
def profile():
    """
    返回html页面数据
    :return:
    """
    # return "<h1>我是个人主页</h1>"
    with open("profile.html") as f:
        content = f.read()
    return content

@app.route("/profile_v2/<user_id>")  # <user_id>表示匹配url时，这里的数据提取出来
def profile_v2(user_id):  # 将提取出来的数据传递给<user_id>中<>内的名字，而且函数的形参也是这个名字
    return "<h1>这是%s的个人主页</h1>" % user_id

if __name__ == '__main__':
    app.run()

```

#### 效果1

![image-20180813090002472](assets/image-20180813090002472.png)

#### 效果2

![image-20180813085817757](assets/image-20180813085817757.png)

## 4. 显示用户的信息

通过上面的示例，已经知道，在函数中，直接利用传递过来的参数，就可以展示给不同用户的页面

那么，赶紧试试吧，下面将之前的个人简历页面显示出来了

#### 示例代码

```python
from flask import Flask

# 创建flask对象
app = Flask(__name__)

@app.route("/")
def index():
    """
    这个函数用来完成一个url对应的逻辑处理
    :return:
    """
    return "哈哈哈 ，我是第一个flask页面，成功的道理开始了..."

@app.route("/test")
def test():
    return "这是test页面"

@app.route("/profile")
def profile():
    """
    返回html页面数据
    :return:
    """
    # return "<h1>我是个人主页</h1>"
    with open("profile.html") as f:
        content = f.read()
    return content

@app.route("/profile_v2/<user_id>")  # <user_id>表示匹配url时，这里的数据提取出来
def profile_v2(user_id):  # 将提取出来的数据传递给<user_id>中<>内的名字，而且函数的形参也是这个名字
    return "<h1>这是%s的个人主页</h1>" % user_id

@app.route("/profile_v3/<user_id>")
def profile_v3(user_id):
    # return "<h1>这是%s的个人主页</h1>" % user_id
    with open("profile.html") as f:
        content = f.read()
    return content

if __name__ == '__main__':
    app.run()

```



#### 效果



![image-20180813111921550](assets/image-20180813111921550.png)

#### 问题

> 用户传递过来的信息没有在页面中进行展示，直白点说这样做，用户传递过的信息毫无用处

#### 解决办法

#### 步骤1：

> 在profile.html文件中，默认的用户名那个位置替换为一个特殊的标记
>
> 什么叫做特殊标记呢？其实就是一个字符串，只要在profile.html文件中出现便于我们用Python代码能够进行替换为想要的数据就行

![image-20180813112701555](assets/image-20180813112701555.png)

#### 步骤2：

> 修改main.py将profile.html文件中读取出来的所有数据中，将上一步自己定义的特殊标签进行替换为用户在url中的用户数据即可

`main.py`完整代码如下:

```python
from flask import Flask

# 创建flask对象
app = Flask(__name__)

@app.route("/")
def index():
    """
    这个函数用来完成一个url对应的逻辑处理
    :return:
    """
    return "哈哈哈 ，我是第一个flask页面，成功的道理开始了..."

@app.route("/test")
def test():
    return "这是test页面"

@app.route("/profile")
def profile():
    """
    返回html页面数据
    :return:
    """
    # return "<h1>我是个人主页</h1>"
    with open("profile.html") as f:
        content = f.read()
    return content

@app.route("/profile_v2/<user_id>")  # <user_id>表示匹配url时，这里的数据提取出来
def profile_v2(user_id):  # 将提取出来的数据传递给<user_id>中<>内的名字，而且函数的形参也是这个名字
    return "<h1>这是%s的个人主页</h1>" % user_id

@app.route("/profile_v3/<user_id>")
def profile_v3(user_id):
    # return "<h1>这是%s的个人主页</h1>" % user_id
    # 1. 读取profile.html文件
    with open("profile.html") as f:
        content = f.read()

    # 2. 将刚刚标记的那个特殊字符串，进行替换；即将xxxx替换为user_id
    content = content.replace("xxxx", user_id)

    # 3. 将替换之后的HTML页面数据返回，浏览器就可以看到自己个人简历了
    return content

if __name__ == '__main__':
    app.run()

```

#### 重启服务器，浏览器打开看效果

![image-20180813113023514](assets/image-20180813113023514.png)



## 5. 升级

#### 思考：

> 怎样显示个人的图片呢？

#### 步骤1：

> 从百度下载一张图片

![image-20180813114359747](assets/image-20180813114359747.png)

![image-20180813114454772](assets/image-20180813114454772.png)

![image-20180813114545174](assets/image-20180813114545174.png)

![image-20180813114845859](assets/image-20180813114845859.png)

#### 步骤2:

> 修改profile.html中用户的图片，用一个特殊的标记来替换，如下图

![image-20180813115240898](assets/image-20180813115240898.png)

#### 步骤3:

> 重启服务器

#### 步骤4:

> 浏览器访问，看效果

![image-20180813115430570](assets/image-20180813115430570.png)



## 6. 总结：

* 路由的作用：规定url对应的函数是哪个
* 浏览器中访问的路由是定义时规定的那个，而不是函数的名字
* 在浏览器的url中可以传递用户的标记信息，从而让函数中知道用户的意图，从而能完成相应的效果
* 浏览器访问web服务器的过程到现在应该明白了，如果感觉生疏，那么只需要多练习几次就可以了